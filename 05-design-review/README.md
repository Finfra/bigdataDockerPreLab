# 5. 설계 문서 검토 및 보완

## 아키텍처 설계 검토
### 5.1 전체 아키텍처 적합성 검토
```
[FMS API] → [Data Collector] → [Kafka] → [Spark Streaming] → [HDFS]
     ↓              ↓              ↓            ↓              ↓
[10s 간격]    [병렬 수집]    [스트리밍]   [실시간 처리]   [파티션 저장]
     ↓              ↓              ↓            ↓              ↓
[5개 장비]    [에러 처리]    [2개 브로커]  [품질 검증]    [백업/복제]
```

#### 설계 강점 분석
* **데이터 처리 파이프라인**
  - 비동기 처리로 높은 처리량 확보
  - Kafka를 통한 데이터 버퍼링으로 안정성 보장
  - Spark Streaming으로 실시간 처리 지원

* **확장성 설계**
  - 컨테이너 기반으로 수평 확장 용이
  - 마이크로서비스 아키텍처 적용
  - 각 컴포넌트 독립적 스케일링 가능

* **내결함성 설계**
  - Kafka 복제본을 통한 데이터 안전성
  - HDFS 다중 복제본 저장
  - 컨테이너 자동 재시작 정책

#### 설계 개선 포인트
* **데이터 수집 계층**: 단일 프로세스 → 장비별 독립 Collector
* **스트리밍 처리**: 단일 Job → 용도별 분리된 Job
* **모니터링**: 기본 메트릭 → 종합 APM + 비즈니스 메트릭


## 잠재적 병목지점 식별
### 5.2 성능 병목지점 체계적 분석

#### 데이터 수집 레이어
* **API 제한사항**
  - finfra.iptime.org:9872 API 동시 요청 제한
  - HTTP 429 오류 및 응답 지연 증가
  - 장비당 2초 지연 및 Circuit Breaker 패턴 필요
* **수집기 성능**
  - 단일 인스턴스 처리 한계 (장비 50개 이상 시)
  - 수평 분산 및 비동기 처리 강화 필요


#### 스트리밍 처리 레이어
* **Kafka 처리량**
  - 파티션 처리 불균형 문제
  - 현재 0.5 TPS → 미래 10 TPS 확장 대비
  - 동적 파티셔닝 전략 및 리밸런싱 필요
* **Spark Streaming**
  - 배치 처리 지연 최적화
  - 메모리 할당 및 체크포인트 설정


#### 저장 레이어
* **HDFS 쓰기 성능**
  - 소용량 파일 다량 생성 (시간당 360개)
  - NameNode 메타데이터 오버헤드 증가
  - 파일 병합 및 압축 전략 필요


### 5.3 네트워크 및 인프라 병목지점
* **모니터링 메트릭**: 네트워크 수신/송신량, Kafka 요청율, HDFS 쓰기량
* **알림 정책**: 네트워크 사용률 100MB/s 초과, Kafka 지연 1000 메시지 초과


## 리스크 분석 및 대응방안 수립
### 5.4 기술적 리스크 매트릭스

| 리스크 유형 | 확률   | 영향도 | 주요 시나리오        | 대응방안                     |
| ----------- | ------ | ------ | -------------------- | ---------------------------- |
| 데이터 손실 | MEDIUM | HIGH   | Kafka/HDFS 장애      | 복제본 3개 설정              |
| 성능 저하   | HIGH   | MEDIUM | 리소스 경합, GC 지연 | 컨테이너 제한, JVM 튜닝      |
| 확장성 한계 | MEDIUM | MEDIUM | 급격한 장비 증가     | 자동화 스크립트, 다중 호스트 |


### 5.5 운영 리스크 분석
* **배포 리스크**: Blue-Green 배포, 설정 버전 관리, 롤백 절차
* **모니터링 공백**: 종합 대시보드, 프로액티브 알림, 장애 대응 플레이북

## 설계 문서 최종 확정
### 5.6 검토 결과 반영사항

#### 주요 변경사항 (v2.0)
* **데이터 수집 개선**
  - API 호출 제한 대응을 위한 Rate Limiting 추가
  - Circuit Breaker 패턴 적용
  - 장비별 독립 수집 프로세스 도입

* **성능 최적화**
  - Kafka 파티션 전략 개선 (장비 ID 기반 → 라운드 로빈)
  - Spark Streaming 배치 크기 최적화
  - HDFS 파일 병합 전략 추가

* **모니터링 강화**
  - 비즈니스 메트릭 추가 (데이터 품질, 처리 지연)
  - 예측적 알림 시스템 도입
  - 성능 벤치마크 기준 수립

* **장애 대응 개선**
  - 자동 복구 메커니즘 강화
  - 데이터 백업 전략 수립
  - 재해 복구 절차 문서화

### 5.7 최종 승인 상태
* **기술 검토**: 아키텍처 확장성, 성능 요구사항, 보안, 데이터 품질 ✓
* **운영 검토**: 배포 절차, 모니터링 범위, 백업 전략, 인시던트 대응 ✓
* **비즈니스 검토**: 요구사항 충족, 일정 타당성, 리소스 할당, 리스크 수용 ✓

## 주요 산출물
* 아키텍처 개선사항 분석서
* 성능 병목지점 식별 및 최적화 방안
* 기술적/운영적 리스크 분석서
* 설계 문서 v2.0 (승인 완료)
